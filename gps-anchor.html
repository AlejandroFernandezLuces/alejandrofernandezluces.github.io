<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Alex Fernandez</title>
  <link rel="stylesheet" href="reset.css" />
  <link rel="stylesheet" href="index.css" />
</head>
<body>
<table class="header">
  <tr>
    <td colspan="2" rowspan="2" class="width-auto"  style="text-align: left;" >
      <h1 class="title">Alex Fernandez</h1>
      <span class="subtitle">Computer Scientist</span>
    </td>
  </tr>
  <tr>
  </tr>
  <tr>
    <th class="width-min">Contact</th>
    <td  style="text-align: left;" class="width-auto"><a href="mailto:21alex295@gmail.com">21alex295@gmail.com</a> / <a href="https://github.com/AlejandroFernandezLuces">Github</a></td>
  </tr>
</table>

<table>
<thead>
<tr>
<th class="width-max">
<a href="index.html">Home</a>
</th>
<th class="width-max">
<a href="blog.html">Blog</a>
</th>
<th class="width-max">
<a href="resume.html">Resume</a>
</th>
</tr>
</thead>
</table>
<h2 id="the-making-of-a-gps-anchor-for-my-boat">The making of: A GPS anchor for my boat</h2>
<p>I, as a horrible fisher, need to have some excuses why I donâ€™t catch even the smallest fish on my fishing outings. I usually blame the weather, or any other condition external to me. One of these excuses is that it is hard to keep in the same place while fishing, since even when anchored, the wind moves you out of place, and usually you stop catching fishes. Donâ€™t tell anyone I wasnâ€™t catching anything before that either.</p>
<p>So, one of the solutions for this is having two anchors in your boat (lame). This causes extra issues, like having a too many ropes in your boat and entangling everything. The solution I would like to have is buying a GPS anchor, an electric outboard with an electronic controller that keeps you in the same GPS spot.</p>
<p>The problem with this is, they are <em>expensive</em>, so I though, why not make one myself, seems easy enoughâ€¦ right?</p>
<p>So I created a proto-prototype, to see if the idea is even feasible. To this end I got:</p>
<ul class="incremental">
<li>An Arduino Nano.</li>
<li>An Arduino Uno, because I fried the first one.</li>
<li>A GPS module NEO 7M for Arduino.</li>
<li>Another GPS module NEO 7m, because I also fried the first one.</li>
<li>A stepper motor.</li>
<li>A compass module.</li>
</ul>
<p>And thatâ€™s it for the moment! The basic idea is to have a system that is capable of always aim to the same GPS coordinate. This is doable by attaching the compass to the top rotating part of the stepper motor, you can calculate the angle between your current position and the desired position. In this first stage, I just set up some made up GPS coordinates, and let the system rotate to aim towards that coordinates based. You need to calculate the compass angle generated by the line that crosses both GPS points, and align the compass angle with that by rotating the stepper motor until aligned. Code looks something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;QMC5883LCompass.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="pp">#include </span><span class="im">&lt;Stepper.h&gt;</span><span class="pp"> </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="dt">double</span> stepsPerRevolution = <span class="dv">360</span>;</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="dt">int</span> error = <span class="dv">20</span>;</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>Stepper myStepper(stepsPerRevolution, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>);  <span class="co">// Pin inversion to make the library work</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>QMC5883LCompass compass;</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="dt">void</span> setup() {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>  Serial.begin(<span class="dv">9600</span>);</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>  compass.init();</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>  myStepper.setSpeed(<span class="dv">10</span>);  </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>}</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="dt">void</span> loop() {</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>    <span class="dt">int</span> x, y, z, a, b;</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>    <span class="dt">char</span> myArray[<span class="dv">3</span>];</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>    compass.read();</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>  </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>    x = compass.getX();</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>    y = compass.getY();</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>    z = compass.getZ();</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>    </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>    a = compass.getAzimuth();</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>    </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>    b = compass.getBearing(a);</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>    compass.getDirection(myArray, a);</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>  </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>  <span class="dt">float</span> heading=atan2(x, y)/<span class="fl">0.0174532925</span>;</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>  <span class="cf">if</span>(heading &lt; <span class="dv">0</span>) heading+=<span class="dv">360</span>;</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>  heading=<span class="dv">360</span>-heading; <span class="co">// N=0/360, E=90, S=180, W=270</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>  </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>  <span class="dt">int</span> desired_direction = <span class="dv">180</span>;</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>  <span class="cf">if</span> (heading &lt; desired_direction - error ) {</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>    myStepper.step(-<span class="dv">3</span>);</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>  }</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>  </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>  <span class="cf">if</span> (heading &gt; desired_direction + error){</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>    <span class="dt">int</span> new_dir = heading - desired_direction;</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>    myStepper.step(<span class="dv">3</span>);</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>  }</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>    Serial.println();</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>  Serial.print(<span class="st">&quot; Current heading: &quot;</span>);</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>  Serial.print(heading);</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>  Serial.print(<span class="st">&quot; Current heading: &quot;</span>);</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>  Serial.print(heading);</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>}</span></code></pre></div>
<p>This is it for now, still a very early prototype, but very promising ðŸš€</p>
  <div class="debug-grid"></div>
  <script src="index.js"></script>
</body>
</html>